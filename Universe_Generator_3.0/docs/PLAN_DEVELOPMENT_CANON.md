# План разработки нового канона (Universe Generator 3.0)

**Назначение:** пошаговый план создания нового канона — от фиксированной философии до полной технической документации и точки входа в реализацию. Философия проекта **полная и завершённая**, **замкнута с обеих сторон** (начальная граница снизу, вселенная и мета-пространство сверху); она **не подлежит изменению в будущем** и используется **исключительно как единственный идеологический ориентир (библия)** для построения проекта: канон и реализация должны ей соответствовать; при противоречии меняют канон или код, а не философию.

**Связь:** [../Scheme.md](../Scheme.md) — схема и новый канон; [../Philosophy.md](../Philosophy.md) — якорь (библия проекта).

**Язык:** русский.

---

## Исходные условия

- **Philosophy.md** — полная и завершённая, замкнута с обеих сторон; не подлежит изменению; используем исключительно как библию проекта (единственный идеологический ориентир).
- **Новый канон** строится **на основе старого** (WorldGenerator_2.0): всё придуманное там — фундамент.
- **Scheme.md** — место, где собирается новый канон (операционная схема + граф ссылок на техническую документацию).
- **docs/** — папка для всей первичной технической документации по уровням и объектам; связь через гиперссылки из Scheme.

---

## Фазы разработки канона (от начала до конца)

### Фаза 0. Якорь (выполнено)

- Философия полная, завершённая, замкнута с обеих сторон; не подлежит изменению в будущем.
- Никаких правок Philosophy при разработке канона и далее; при противоречии меняем схему и документы, а не философию. Philosophy — единственная библия проекта.

---

### Фаза 1. Операционная схема (с чего логично начать)

**Цель:** иметь **единый источник правды** по тому, как устроен мир и что от него требуется: цикл, state, переходы, условия выполнения, первая итерация, Action.

**Что делать:**
- В **Scheme.md** (или в отдельном документе в docs/, на который Scheme ссылается) **полностью прописать операционную схему** для 3.0:
  - цикл мира: Философ → Автор → Среда → Архитектор → Творец;
  - state: пять блоков, семантика каждого;
  - Среда: два узла (World update, Development of the world), условия выполнения;
  - правила: когда какой переход выполняется (по заполненности блоков state);
  - первая итерация без предзаданного state; Action опционален.
- Опираться на старый канон [WorldGenerator_2.0/Scheme.md](../../WorldGenerator_2.0/Scheme.md), переносить и при необходимости уточнять формулировки под 3.0.
- Результат: любой следующий документ (уровни, контракты) может ссылаться на Scheme и знать «как мир работает».

**Почему начинать с этого:** без зафиксированной операционной схемы непонятно, какие контракты должны быть у этапа (Stage), мира (World) и нижележащих уровней. Схема задаёт **цель** проектирования; фундамент и уровни проектируются так, чтобы её поддержать.

---

### Фаза 2. Фундамент (блок и узел)

**Цель:** зафиксировать контракт **Abstract Base Block** и **Abstract Graph Node** — порты, run, сериализация, правило «блок → узел», гиперграф.

**Что делать:**
- Создать в **docs/** документ уровня фундамента (например, `Foundation_Block_And_Node.md` или аналог).
- Описать: что хранит блок, что задаёт узел, контракт (get_input_spec, get_output_spec, run), порты, жизненный цикл, реестр типов, сериализация (конфиг + чекпоинт). Опираться на [WorldGenerator_2.0/Abstract_Block_And_Node.md](../../WorldGenerator_2.0/Abstract_Block_And_Node.md).
- В **Scheme.md** добавить в раздел «Документация 3.0» ссылку на этот документ.

**Порядок:** после Фазы 1, до уровней (граф, пайплайн, этап, мир) — потому что все уровни строятся из блоков и узлов.

---

### Фаза 3. Уровни снизу вверх

**Цель:** по одному документу (или одному разделу) на каждый уровень иерархии, с контрактами и ссылками на Scheme и философию.

**Порядок документов (снизу вверх):**
1. **Узлы-задачи (над фундаментом)** — Backbone, Solver, Codec, Conditioner, Tokenizer, Adapter, Guidance, Agent; двойное наследование Block+Node, порты, типичные связи. Референс: [Abstract_Task_Nodes.md](../../WorldGenerator_2.0/Abstract_Task_Nodes.md).
2. **Уровень графа** — один гиперграф = одна задача; узлы-задачи, сборка, исполнение, сериализация. Референс: [Graph_Level.md](../../WorldGenerator_2.0/Graph_Level.md).
3. **Уровень пайплайна** — гиперграф гиперграфов; что течёт между графами. Референс: [Pipeline_Level.md](../../WorldGenerator_2.0/Pipeline_Level.md).
4. **Уровень перехода (Stage)** — гиперграф пайплайнов, один переход = одна метаморфоза state; связь с операционной схемой (роли Философ, Автор, Среда, Архитектор, Творец). Референс: [Stage_Level.md](../../WorldGenerator_2.0/Stage_Level.md).
5. **Уровень мира (World)** — граф переходов, цикл, state, Среда как два узла. Жёсткая связь с Scheme. Референс: [World_Level.md](../../WorldGenerator_2.0/World_Level.md).
6. **Уровень вселенной (Universe)** — гиперграф миров, обмен, сообщество, End Worlds. Референс: [EXPANSION_UNIVERSE_GRAPH_OF_WORLDS.md](../../WorldGenerator_2.0/EXPANSION_UNIVERSE_GRAPH_OF_WORLDS.md).

По каждому уровню: создать файл в **docs/** (или один файл System с разделами), в Scheme.md добавить ссылку в граф гиперссылок.

---

### Фаза 4. Сквозные темы и индекс канона

**Цель:** документы по сериализации, агентам, API, гиперграфу и гиперссылкам, LoRA-world, повторному использованию моделей и т.д.; итоговый индекс (аналог CANON.md) для 3.0 с полным графом ссылок.

**Что делать:**
- В **docs/** добавить (или ссылаться на старый канон с пометкой «для 3.0 без изменений»): сериализация мира, агентные системы, LLM/API, модель reuse, LoRA-world, гиперграф и гиперссылки, End Worlds.
- В **Scheme.md** или в **docs/CANON_3.0.md** — единый индекс нового канона: перечень всех документов с гиперссылками (по уровням и сквозным темам), чтобы граф документации был явным и соответствовал философии.

---

### Фаза 5. Реализация (код)

**Цель:** разработка кода фреймворка в **yggdrasill/** по канону.

**Условие:** канон (Scheme + docs) достаточен, чтобы реализация следовала ему без двусмысленностей. Реализация не предшествует канону; канон — первичен.

(Детальный план реализации — отдельный документ, например TODO по уровням, по мере готовности канона.)

---

## С чего начать проектирование (рекомендация)

**Самый правильный и логичный старт — Фаза 1: операционная схема.**

1. **Философия уже задаёт «что» и «зачем»**; не хватает однозначного «как» в смысле операций мира. Пока схема не зафиксирована в новом каноне, остальные документы могут расходиться в деталях (например, когда именно выполняется World update, что входит в state).
2. **Схема — верхний уровень целевой системы.** Мир и этапы существуют ради этой схемы; граф, пайплайн и блоки — ради поддержки этапов и мира. Зафиксировав схему первой, мы задаём целевой контракт, под который потом проектируем уровни и фундамент.
3. **Минимум зависимостей:** операционная схема опирается на старый Scheme и на философию; для её текста не нужны ещё не написанные docs/ 3.0.
4. **Быстрый результат:** один цельный раздел в Scheme.md (или один файл в docs/, например `Scheme_Operational.md`), на который потом ссылаются все уровни.

**Конкретный первый шаг:**  
В **Scheme.md** добавить полный раздел **«Операционная схема мира (канон 3.0)»**: перенести и при необходимости адаптировать из [WorldGenerator_2.0/Scheme.md](../../WorldGenerator_2.0/Scheme.md) разделы про цикл, state (пять блоков), Среда (два узла), условия выполнения, жизненный цикл state, первую итерацию и Action. Либо вынести это в **docs/Scheme_Operational.md** и в Scheme.md оставить краткое резюме и ссылку. После этого переходить к Фазе 2 (фундамент Block/Node) и далее по плану.

---

## Итоговая последовательность

| Шаг | Фаза | Результат |
|-----|------|-----------|
| 0 | Якорь | Philosophy закрыта ✓ |
| 1 | Операционная схема | В Scheme (или docs/) — полная схема мира, state, переходы, условия |
| 2 | Фундамент | docs: Block, Node, контракт, порты, сериализация |
| 3 | Уровни | docs: Task Nodes → Graph → Pipeline → Stage → World → Universe |
| 4 | Сквозное + индекс | docs: сериализация, агенты, API, гиперграф, CANON_3.0 (граф ссылок) |
| 5 | Реализация | Код в yggdrasill/ по канону |

**С чего начать:** с **Фазы 1** — полная операционная схема в новом каноне (в Scheme.md или в docs/ со ссылкой из Scheme).
