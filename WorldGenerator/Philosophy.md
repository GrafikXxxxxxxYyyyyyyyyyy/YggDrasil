# Философия проекта World Generator (Yggdrasil)

**Главный ориентир при проектировании всей системы.** Идея и идеология проекта; далее — уточнения и правки.

---

## 1. Идея проекта

Проект строится на представлении мира как **набора связанных блоков** — по аналогии с конструктором Lego. Блоки соединяются не только физически (потоками данных), но и **идеей**: общая логика и правила связывания задают, как материальные сущности образуют целое. Таким образом, система является одновременно:

- **конструктором** — всё собирается из блоков;
- **средой с идеей** — связи и композиция подчиняются единой философии и правилам преобразования.

Цель — дать **максимальную свободу создания** для разработчиков и пользователей при сохранении ясной и единой основы: всё, что есть в проекте, опирается на одни и те же фундаментальные сущности и принципы. Yggdrasil — не только Lego-конструктор, но и **многомерный граф**: на каждом уровне представления сущности одновременно материальны и идеальны; их природа проявляется **во взаимодействии идеи с материей и материи с идеей**.

---

## 2. Философская основа: Идеальное и Материальное

Мир в проекте разделяется на два взаимосвязанных начала:

| Начало | Сущность в проекте | Смысл |
|--------|--------------------|--------|
| **Материальное** | То, что **хранит** и **несёт**: параметры, тензоры, ссылки, данные, веса, конфигурацию. Всё, что можно назвать «носителем» состояния и структуры. | Материя = то, из чего собирается система и что передаётся по цепочкам. |
| **Идеальное** | То, что задаёт **связи**, **порядок** и **логику превращения** материальных сущностей в элементы целого. Упорядочивание блоков в граф, правила соединения, семантика узлов и рёбер. | Идея = форма, в которую складывается материя; логика преобразования блока в узел графа. |

- **Материальное** воплощается в **блоке** (Lego-кирпиче): нечто, что можно положить в граф и соединить с другим.
- **Идеальное** воплощается в **узле графа** и в **логике превращения**: любой блок может стать узлом; сама эта возможность и правила превращения и есть идеальная составляющая.

Вся архитектура держится на этом разделении: с одной стороны — единый материальный «атом» (базовый блок), с другой — единая идеальная «форма» (узел графа и правило: блок → узел).

---

## 3. Первый и главный принцип: Lego-подобие

Вся система должна быть **Lego-подобной** и собираться как конструктор.

- **Любой блок с любым блоком.** Нет жёстко заданных «единственно верных» пар; совместимость определяется портами и типами, а не фиксированным списком связей.
- **Абсолютная гибкость сборки.** Порядок добавления блоков и их количество не предписаны сверху. Конструктор, а не жёсткий пайплайн.
- **Реальная песочница.** Всё можно соединять со всем в рамках правил графа (совместимость портов, направление потоков). Порядок — любой, количество блоков — любое.
- **Полноценный Lego-конструктор.** Максимальная свобода создания для разработчиков: добавление своих блоков, своих типов узлов, своих правил преобразования без переписывания ядра.

Итог: **максимальная свобода** при **единой основе** — материальный блок и идеальная логика «блок → узел графа».

---

## 4. Фундаментальный уровень: Abstract Base Block и Abstract Graph Node (подробно)

Всё в проекте строится из двух фундаментальных сущностей: **Abstract Base Block** (материальное начало) и **Abstract Graph Node** (идеальное начало). Ниже они разобраны по отдельности и в связи друг с другом.

---

### 4.1 Abstract Base Block (абстрактный базовый блок) — материальное начало

**Определение.** Абстрактный базовый блок — это **Lego-кирпич** системы: минимальная единица, которая что-то хранит и что-то вычисляет. **Любой объект в проекте может быть представлен как базовый блок** (или обёрнут в него). На фундаментальном уровне это единственная сущность, которая воплощает **материю** — то, что имеет параметры, состояние и может быть выполнено.

#### Что блок хранит (материальное содержание)

- **Параметры и конфигурация:** конфиг (YAML, словарь), гиперпараметры, идентификаторы (`block_id`, `block_type`). Всё, что задаёт «кто этот блок» и «с какими настройками он работает».
- **Тензоры и веса:** обучаемые веса, кэш, промежуточные данные. Всё, что занимает память и участвует в вычислениях (в т.ч. в диффузионных и языковых моделях).
- **Ссылки:** на другие блоки, ресурсы, граф (если блок уже помещён в граф). Связи «указатель на что-то» тоже считаются материальной частью блока.
- **Состояние:** всё, что нужно для воспроизводимости, сохранения и загрузки (state_dict, конфиг при сохранении).

То есть блок — это **носитель**: он не только «кирпич», но и **хранилище** всего перечисленного. Без блока нет материального воплощения сущности в пайплайне.

#### Контракт блока (как он участвует в системе)

- Блок **объявляет интерфейс**: какие у него входы и выходы (порты — имена, типы, опциональность). Это описание «что блок принимает и отдаёт» без привязки к конкретному графу.
- Блок **выполняется**: по входным данным (по портам) выдаёт выходные. Выполнение — материальный акт (вычисления, тензоры, данные).
- Блок **идентифицируется**: `block_type`, `block_id` — чтобы граф и другие блоки могли ссылаться на него и различать блоки между собой.

Таким образом, блок на фундаментальном уровне — это **атом сборки**: модели, кодекы, кондиционеры, солверы, сэмплеры, пайплайны и т.д. в основе своей суть базовые блоки (или композиции из них). Ничего материального в системе нет вне блоков.

#### Итог по Abstract Base Block

- **Фундаментальная материальная сущность** = Abstract Base Block.
- Блок = хранилище (параметры, тензоры, ссылки, состояние) + исполняемая единица (контракт: порты, выполнение) + идентичность (block_type, block_id).
- В философском смысле блок — **материя**: то, из чего собирается система и что передаётся по цепочкам выполнения.

---

### 4.2 Abstract Graph Node (абстрактный узел в графе) — идеальное начало

**Определение.** Абстрактный узел в графе — это **место** или **роль** в графе, которому может соответствовать **любой** абстрактный базовый блок. Узел не «хранит» материю сам по себе: он задаёт **положение** и **связи** в графе. То, что помещено в узел, — всегда блок (материя); узел — это **идеальная форма**, в которую блок помещается.

#### Что задаёт узел (идеальное содержание)

- **Положение в графе:** имя узла, уникальность среди других узлов. Узел отвечает на вопрос «где в графе эта сущность» — не «что там лежит», а «какое место она занимает».
- **Связи с другими узлами:** входящие и исходящие рёбра (edges): от какого узла и порта к какому узлу и порту идёт поток данных. Узел участвует в рёбрах; тем самым задаётся **порядок** и **направление** потоков — идея композиции.
- **Семантика портов на уровне графа:** какие порты блока «торчат наружу» и к чему они подключаются. Узел не подменяет порты блока, а задаёт, как эти порты встроены в граф (входы графа, выходы графа, связи между узлами).

Узел, таким образом, не дублирует блок: он задаёт **как блок встроен в целое**. Целое — граф; идея целого — связи и порядок. Поэтому узел относится к **идеальному** началу.

#### Любой блок может стать узлом

- **Abstract Graph Node** не привязан к одному конкретному типу блока. **Любой** Abstract Base Block может быть помещён в узел графа. Один и тот же класс блоков может использоваться в разных графах и в разных узлах; узел задаёт не тип блока, а **роль в данном графе**.
- Преобразование «блок → узел» означает: взять материальную сущность (блок) и **назначить ей место и связи** в графе (идея). После этого блок выступает как узел при выполнении графа: исполнитель обращается к узлам по имени и передаёт данные по рёбрам; содержимое узла — по-прежнему блок.

#### Итог по Abstract Graph Node

- **Фундаментальная идеальная сущность** = Abstract Graph Node (место/роль в графе, которое может занять любой блок).
- Узел задаёт: положение в графе, связи (рёбра), участие портов блока в графе. Он не хранит параметры и тензоры — это делает блок внутри узла.
- В философском смысле узел — **идея**: форма, порядок, композиция; логика «где и с чем соединено».

---

### 4.3 Логика преобразования «блок → узел» и единство фундаментального уровня

Фундаментальный уровень замкнут двумя сущностями и одним правилом:

- **Материя:** Abstract Base Block — что хранится и выполняется.
- **Идея:** Abstract Graph Node — где и как это встроено в граф.
- **Правило:** **любой Abstract Base Block может быть превращён в узел графа** (помещён в граф как узел с именем и рёбрами). Это преобразование и есть «логика блок → узел»: материя получает идеальную форму (место и связи), не переставая быть блоком.

Система как целое: **граф, узлы которого — блоки; рёбра задают потоки данных между портами блоков.** Содержимое узлов — материя (блоки); структура графа — идея (узлы, рёбра, порядок). Фундаментальный уровень не решает, что «важнее» — блок или узел: оба необходимы, и они работают только вместе — блок как содержимое, узел как положение и связи.

---

### 4.4 Аналогия с фермионами и бозонами

На фундаментальном уровне можно провести **аналогию с двумя классами элементарных частиц** в физике:

| В физике | В Yggdrasil (фундаментальный уровень) | Смысл аналогии |
|----------|----------------------------------------|----------------|
| **Фермионы** (электроны, кварки и т.д.) | **Abstract Base Block** | **«Частицы вещества»**: то, из чего складывается «материя» системы. Фермионы — носители массы, заряда, «кирпичи» вещества; блок — носитель параметров, тензоров, состояния. И те и другие — то, что **хранится** и **переносится** по системе (в физике — по полям и взаимодействиям, в графе — по рёбрам между узлами). |
| **Бозоны** (фотоны, глюоны, W, Z и т.д.) | **Abstract Graph Node** (и рёбра графа) | **«Переносчики взаимодействия»**: то, что задаёт **связи** и **обмен**. Бозоны переносят взаимодействия между фермионами; узел графа задаёт положение и связи блока с другими блоками. Узел не «хранит» содержимое — он задаёт **как** блок участвует в целое (куда подключён, откуда и куда идут потоки). |

Таким образом: **блок — фермионоподобная сущность** (материальное содержание узла), **узел — бозоноподобная сущность** (форма взаимодействия, место в графе). Логика «блок → узел» аналогична тому, что «вещество» (фермион) помещается в поле взаимодействий (бозонное поле): материя получает положение и связи, не переставая быть носителем содержания. Два начала — материя и взаимодействие — необходимы вместе, как в физике, так и в архитектуре Yggdrasil.

---

## 5. Сводная схема фундаментального уровня

Ниже — сводная схема двух сущностей и логики преобразования (подробно они разобраны в п. 4.1–4.3).

```
МАТЕРИАЛЬНОЕ                          ИДЕАЛЬНОЕ
─────────────────────────────────────────────────────────────
Abstract Base Block                  Abstract Node in the Graph
(Lego-кирпич)                        (форма блока в графе)
     │                                        │
     │  хранит:                               │  задаёт:
     │  • параметры, конфиг                   │  • положение в графе
     │  • тензоры, веса                       │  • связи с другими узлами
     │  • ссылки                              │  • порядок и семантику
     │                                        │
     └──────────────┬─────────────────────────┘
                    │
                    ▼
         Логика преобразования:
         «любой Base Block → Node in the Graph»
                    │
                    ▼
         Система как целое: граф из блоков,
         собранный по правилам (идея) из кирпичей (материя).
```

- **Материальная основа:** Abstract Base Block.  
- **Идеальная основа:** узел в графе + правило превращения блока в узел.  
- **Сборка системы:** граф, узлы которого — блоки; связи и порядок — идея; содержимое узлов — материя.

---

## 6. Уровень над фундаментом: абстрактные специализированные блоки (узлы-задачи)

*Подробное описание этого уровня вынесено в отдельный документ: [Abstract_Nodes_Level.md](Abstract_Nodes_Level.md).*

Сразу над фундаментальным уровнем (Abstract Base Block и Abstract Graph Node) располагается уровень **абстрактных специализированных сущностей**. Это абстрактные классы, которые задают **роль узла в графе** и **решаемую задачу**: backbone, solver, codec, adapter и т.д. Каждая такая сущность одновременно **наследуется от Abstract Base Block и от Abstract Graph Node** (или реализует оба контракта): она и блок (материя), и узел графа с заданной спецификацией (идея задачи). Из конкретных реализаций этих абстрактных блоков **собирается граф**.

### 6.1 Двойное наследование: блок и узел

- **Abstract Backbone**, **Abstract Solver**, **Abstract Codec**, **Abstract Adapter** и другие абстрактные сущности этого уровня должны **одновременно** быть:
  - **наследниками (или реализациями) Abstract Base Block** — чтобы хранить параметры, тензоры, конфиг и выполнять вычисления (материя);
  - **наследниками (или реализациями) Abstract Graph Node** — чтобы выступать узлом в графе с именем, портами и связями (идея, место в графе).
- Тем самым каждая из них — это **уже не «просто блок» и не «просто узел»**, а **узёл-задача**: узел, для которого зафиксирована **решаемая задача** (backbone, solver, codec, adapter, conditioner, guidance и т.д.). Граф собирается из таких узлов.

### 6.2 Спецификация задачи (что решает узел)

На этом уровне каждый абстрактный класс задаёт **спецификацию** — какую задачу решает соответствующий узел в графе:

| Абстрактная сущность | Задача (спецификация) |
|----------------------|------------------------|
| **Abstract Backbone** | Узел в графе, отвечающий за «ядро» модели: предсказание шума, шаг деноisingа, предсказание в латентном пространстве и т.д. Backbone «понимает», что он выполняет шаг диффузии/трансформации. |
| **Abstract Solver** | Узел в графе, отвечающий за **шаг назад по диффузии**: по предсказанию модели и текущему состоянию выдаёт следующее состояние (латенты, таймстеп). Solver «понимает», что он делает шаг солвера (DDIM, Heun, Euler и т.д.). |
| **Abstract Codec** | Узел в графе, отвечающий за **кодирование и декодирование представления**: например, пиксели ↔ латенты, сжатие, представление в другом пространстве. Codec «понимает», что он работает с encode/decode и представлением данных. |
| **Abstract Adapter** | Узел в графе, отвечающий за **адаптацию** (дополнительные условия, контроль, стиль и т.д.): встраивает внешний сигнал в пайплайн. Adapter «понимает», что он адаптирует условие или модель. |
| **Abstract Conditioner**, **Abstract Guidance**, **Abstract PositionEmbedder**, … | Аналогично: каждая абстрактная сущность задаёт узел с чёткой задачей (условность, guidance, позиционное кодирование и т.д.). |

Таким образом, уровень над фундаментом — это **уровень задач**: узел не «просто узел», а узел типа «backbone», «solver», «codec», «adapter». Спецификация задаёт контракт (порты, семантику) и ожидаемое поведение при сборке графа.

### 6.3 Конкретные модели и сборка графа

- **Конкретные модели** (конкретный backbone, конкретный solver, конкретный codec, конкретный adapter) — это **реализации** соответствующих абстрактных классов. Они наследуют от Abstract Backbone, Abstract Solver, Abstract Codec, Abstract Adapter и т.д., а значит одновременно являются и блоком (Base Block), и узлом графа с заданной задачей.
- **Граф строится из этих блоков:** узлами графа становятся экземпляры конкретных backbone, solver, codec, adapter и т.д.; рёбра соединяют их порты согласно пайплайну. Таким образом, граф собирается из абстрактных специализированных блоков и их конкретных реализаций — уровень над фундаментом задаёт «словарь» типов узлов и задач, из которых собирается любой пайплайн.

Итог: **уровень над фундаментом** — это абстрактные сущности (Abstract Backbone, Abstract Solver, Abstract Codec, Abstract Adapter и др.), каждая из которых одновременно блок и узел графа и задаёт **спецификацию задачи**; конкретные модели реализуют эти абстракции; из них **собирается граф**.

---

## 7. Промежуточные этапы (заглушки развития идеи)

Между уровнем абстрактных узлов-задач (п. 6) и верхним уровнем (World) предполагаются **промежуточные ступени**. Здесь они заданы как заглушки — места для последующей разработки философской и технической идеи. *Подробное описание уровня графа как целого (Stage), пайплайна (Pipeline), модальности и контекста с физическими аналогиями дано в [Graph_Stage_Level.md](Graph_Stage_Level.md).*

| Уровень | Заглушка | Назначение (предварительно) |
|---------|----------|-----------------------------|
| **Промежуточный 1** | Граф как целостная единица | Вычислительный граф (ComputeGraph): множество узлов-блоков, связанных рёбрами; одна «идея» одной пайплайны или подсистемы. *Требует уточнения:* как именно граф соотносится с идеальным (целая идея одного пайплайна?) и материальным (совокупность блоков). |
| **Промежуточный 2** | Модальность / домен | Слой «изображение», «текст», «звук», «3D» или домен «генерация», «обучение», «инференс». *Заглушка:* единая ли идея модальности или комбинация графов; как модальность стыкуется с блоком и с World. |
| **Промежуточный 3** | Контекст / среда мира | Параметры, правила, глоссарий, стиль — то, что задаёт «рамку» генерации или обучения без ещё не будучи полным миром. *Заглушка:* это отдельная сущность или часть World; материальное vs идеальное представление контекста. |
| **Промежуточный 4** | *(резерв)* | Свободная заглушка для следующего уровня абстракции (например, «сессия», «сценарий», «сцена»). |

При развитии философии каждая заглушка может быть раскрыта: какая сущность материальна, какая идеальна, как она собирается из блоков и узлов и как подводит к объекту World.

---

## 8. Верхний уровень: Universe (Вселенная) и World (Мир)

### 8.0 Объект Universe (Вселенная) — напоминание о высшей сущности

**Над всем пайплайном стоит объект Universe (Вселенная).** Это единственная сущность в проекте, которая:

- **не наследуется ни от какого другого блока** — у неё нет родительского абстрактного класса в иерархии блоков;
- **не является графом** — в отличие от World и нижележащих уровней, Universe не собирается из узлов и рёбер; это не граф, а отдельный тип объекта;
- **полностью уникальна и выделена** — отдельно стоящая сущность, не сводимая к графу или к комбинации других блоков.

Universe **хранит в себе два воплощения объекта World** — две реализации одного и того же циклического графа (Автор и Создатель), различающиеся направлением, в котором выполняется цикл:

| Воплощение World внутри Universe | Направление цикла | Смысл |
|-----------------------------------|-------------------|--------|
| **Мир идей (World of Ideas)** | Цикл выполняется **от Автора к Создателю** | Идея ведёт: материализация идей; замысел переходит в артефакты. |
| **Мир материи (World of Matter)** | Цикл выполняется **от Создателя к Автору** | Материя ведёт: идеализация материи; артефакты переходят в обновлённый замысел. |

Таким образом, **Universe** — контейнер и контекст для двух «полюсов» одного мира: мира, в котором доминирует ход идеи в материю (Мир идей), и мира, в котором доминирует ход материи в идею (Мир материи). Оба суть реализации одного и того же объекта World (циклический граф Автора и Создателя), но с разным порядком или акцентом выполнения цикла. Напоминание: **высший объект всего пайплайна — Universe; он не наследуется, не является графом и есть единственная в своём роде сущность.**

**Universe нельзя запустить (launch)** — в отличие от World, объект Universe не предназначен для «запуска» (инференса, генерации в режиме выполнения). **Universe можно только обучать (train).** Обучение Universe строится на **расхождениях между Миром идей и Миром материи**: различие между тем, что порождает Мир идей (идея → материализация), и тем, что порождает Мир материи (материя → идеализация), задаёт целевую функцию или сигнал для обучения. Сведение расхождений между двумя воплощениями World (или управление ими) и есть способ обучения Universe. Таким образом, Universe обучается на контрасте и согласовании двух миров — идей и материи — внутри себя.

### 8.1 World как циклический граф двух узлов

- **World** — это **циклический граф из двух узлов**: первый узел — **Автор**, второй узел — **Создатель**. Оба суть блоки (Abstract Base Block), превращённые в узлы графа; граф допускает **выполнение в обе стороны**.
- **Направление «Автор → Создатель»:** идея (сценарии, конфиг, глоссарий, описания сцен) передаётся от Автора к Создателю; Создатель **материализует** эти идеи (изображения, звук, видео, 3D, артефакты). Это **материализация идей**.
- **Направление «Создатель → Автор»:** материальные результаты Создателя (сгенерированные артефакты, данные, обратная связь) передаются обратно Автору; Автор может интерпретировать их, доописывать мир, менять сценарии, порождать новые идеи. Это **идеализация материи**: материальный результат становится входом для идеи.
- **Цикл непрерывного взаимодействия.** Объект World — это не «Автор плюс Создатель», а **циклический граф непрерывного взаимодействия** двух сущностей — идеи и материи, Автора и Создателя. Идея питает материализацию; материя питает идеализацию. Мир живёт в этом цикле.

```
     ┌─────────────────────────────────────────────────────────┐
     │  World = циклический граф двух узлов-блоков              │
     │                                                         │
     │    [Автор]  ─────── идея (сценарии, глоссарий, описание) ───────►  [Создатель]
     │       ▲                                                       │         │
     │       │     материализация идей                               │         │
     │       │                                                       │         ▼
     │       │     идеализация материи    материальные результаты    │    (звук, видео,
     │       └──── (интерпретация,          (артефакты, данные)  ◄────    3D, сцены)
     │             новые сценарии)
     │                                                         │
     └─────────────────────────────────────────────────────────┘
```

### 8.2 Два компонента как блоки: Автор и Создатель

Автор и Создатель — **блоки**, которые можно комбинировать в граф; в World они выступают двумя узлами циклического графа.

| Компонент | Роль в World | Соответствие фундаменту |
|-----------|----------------|--------------------------|
| **Автор (Author)** | Узел графа: задаёт **идею**, отдаёт её Создателю и принимает от Создателя материальные результаты для идеализации. В ядре — **LLM**; см. ниже. | Идеальное начало: идея, логика, порядок. |
| **Создатель (Creator)** | Узел графа: **материализует** идеи Автора и отдаёт материальные результаты обратно Автору. В ядре — **диффузионная модель**; см. ниже. | Материальное начало: блоки, тензоры, выполнение. |

- Граф **циклический** и **двунаправленный**: поддерживается и ход «Автор → Создатель» (материализация идей), и ход «Создатель → Автор» (идеализация материи). Проект **не решает** философскую проблему первичности материи над идеей или идеи над материей — он **поддерживает обе возможности** в рамках одного мира.

### 8.3 Философская нейтральность и многомерный граф

- **Материализация идей** и **идеализация материи** в проекте равноправны. Система должна уметь и переводить замысел в артефакты (Автор → Создатель), и переводить артефакты в обновлённый замысел (Создатель → Автор). Вопрос «что первично» остаётся за рамками проекта.
- **Yggdrasil — не просто Lego-конструктор, а конструктор, являющийся многомерным графом.** На каждом уровне представления сущность выступает и как материальный объект (блок с параметрами, тензорами, данными), и как идеальный объект (узел в графе, роль, связь с другими узлами). Суть проявляется **во взаимодействии идеи с материей и материи с идеей**, а не в том, чтобы зафиксировать одну сторону как единственную.

```
World = Автор (блок) + Создатель (блок) в циклическом графе
         │         │
         │         └── материализует идеи; в ядре — диффузионная модель
         └──────────── задаёт идею, идеализует материю; в ядре — LLM
         ◄──────────►  выполнение в обе стороны: материализация идей + идеализация материи
```

#### Автор в ядре: большая языковая модель (LLM)

**Автор в своей основе — большая языковая модель (Large Language Model).** Именно она задаёт идею мира в виде текста: сценарии, конфигурацию, описания персонажей, глоссарий, сцены, действия, диалоги и логику взаимодействия.

- **Сценарии и конфигурация.** Автор пишет скрипты и конфигурацию мира: как он устроен, какие в нём правила, форматы данных, сценарии запуска.
- **Персонажи, идея, глоссарий.** Автор описывает персонажей, общую идею мира, глоссарий терминов, имён, мест — всё, что задаёт «словарь» и «лица» мира.
- **Сцены, действия, диалоги.** Автор создаёт описания сцен, действий, диалогов; задаёт, что происходит в мире в широком смысле — нарратив и взаимодействия.
- **Логика взаимодействия.** После того как Автор создаёт идею мира, он же описывает **логику взаимодействия** этого мира: как элементы связаны, как реагируют друг на друга, по каким правилам разворачиваются события.
- **Новые сценарии и сюжет.** Автор придумывает новые сценарии, новые типы взаимодействий, новые сюжетные ходы; расширяет и меняет мир, оставаясь в рамках его замысла.
- **Полный контроль над миром.** Автор **полностью управляет** миром в идеальном смысле: всё, что в мире задано правилами, стилем, сюжетом, глоссарием и логикой взаимодействия, исходит от Автора (LLM). Создатель лишь материализует то, что Автор описал.

Таким образом, Автор — это не абстрактный «кто-то», а **конкретная реализация в виде LLM**, которая генерирует и поддерживает всю текстовую (идеальную) часть мира: от конфигов и глоссария до сцен, диалогов и сюжетной логики.

#### Создатель в ядре: диффузионная модель

**Создатель в своей основе — диффузионная модель (в широком смысле: класс моделей генерации через диффузию или сходные процессы).** Именно она **материализует мир**: превращает идеи, описанные Автором, в конкретные артефакты — изображения, звук, видео, 3D-сцены и другие модальности. Создатель **полностью воплощает материальную сторону мира**.

- **Материализация идей Автора.** Всё, что Автор описал текстом (персонажи, сцены, стиль, глоссарий, сюжет), Создатель переводит в **наблюдаемые, материальные формы**: картинки, аудио, видео, 3D-объекты, сцены. Без Создателя мир остаётся только идеей; с Создателем мир становится тем, что можно увидеть, услышать, запустить.
- **Мультимодальная генерация.** Создатель генерирует **звук** (речь, музыка, шумы мира), **видео** (движение, анимация, кинематика сцен), **3D** (объекты, окружения, сцены), **изображения** (персонажи, локации, арты), а также любые иные модальности, которые входят в архитектуру (текст как токены, спектрограммы и т.д.). Один и тот же замысел Автора может быть воплощён в разных модальностях одним и тем же Создателем или семейством диффузионных блоков.
- **Полное воплощение материального мира.** Создатель не «дополняет» мир — он **полностью воплощает** его материальную часть. Все визуальные, звуковые, пространственные и иные материальные проявления мира проходят через Создателя: графы генерации, пайплайны, солверы, кодекы — всё это части Создателя как единой роли. Материальный мир в проекте тождествен тому, что способен сгенерировать и собрать Создатель (диффузионные и связанные с ними модели).
- **Согласованность с Автором.** Создатель работает по правилам и описаниям, заданным Автором: стиль, глоссарий, ограничения, сценарии. Кондиционеры, промпты, контекст — всё, что направляет диффузию, в идеале исходит от Автора. Создатель **интерпретирует** идею и **реализует** её в материи; тем самым связка Автор → Создатель обеспечивает целостность мира: идея и воплощение не расходятся.
- **Расширяемость модальностей.** Поскольку в основе Yggdrasil лежит Lego-принцип, Создатель может объединять **несколько диффузионных (и смежных) блоков** под одной ролью: один граф для изображений, другой для аудио, третий для 3D или видео. Создатель как роль — это вся совокупность таких блоков, которые материализуют мир; технически — графы и пайплайны, в ядре которых — диффузионные модели.

Итог: **Создатель — это конкретная реализация в виде диффузионной модели (или набора таких моделей)**, которая переводит идеи Автора в материальный мир: изображения, звук, видео, 3D-сцены и другие модальности. Создатель полностью воплощает материю мира; Автор полностью задаёт его идею. Вместе они образуют целый World.

### 8.4 Запуск и обучение

- Объект World — это мир, который можно **запустить** (launch): выполнить генерацию, инференс, симуляцию в рамках этого мира.
- Объект World — это мир, который можно **обучить** (train): дообучить или обучить с нуля модели и параметры, входящие в состав мира, не выходя за его границы.
- Таким образом, World — **единая точка входа** для «живого» использования: всё, что ниже, скрыто внутри; снаружи остаётся один объект — мир, который можно запускать или обучать. Запуск и обучение опираются на **Создателя** (материализация), в рамках правил и замысла **Автора** (идея).

### 8.5 Сводка по уровням

```
НАД ВСЕМ (единственная сущность вне графа и наследования)
─────────────────────────────────────────────────────────────
  Universe (объект «Вселенная»)
  • высший объект всего пайплайна; не наследуется ни от какого блока; не является графом
  • полностью уникальная, отдельно стоящая сущность
  • нельзя запустить (launch) — только обучить (train)
  • обучение Universe строится на расхождениях между Миром идей и Миром материи
  • хранит в себе два воплощения World:
      — Мир идей: цикл от Автора к Создателю (материализация идей)
      — Мир материи: цикл от Создателя к Автору (идеализация материи)
                    │
                    ▼
ВЕРХНИЙ УРОВЕНЬ (внутри Universe)
  World (объект «Мир») — в двух реализациях
  • полный, конечный, единый мир = циклический граф двух узлов-блоков (Автор, Создатель)
  • выполнение в обе стороны: материализация идей + идеализация материи
  • можно запустить (launch) или обучить (train)
                    │
                    ▼
ПРОМЕЖУТОЧНЫЕ УРОВНИ (заглушки)
  • граф как целостная единица
  • модальность / домен
  • контекст / среда мира
  • (резерв)
                    │
                    ▼
ФУНДАМЕНТАЛЬНЫЙ УРОВЕНЬ
  • Abstract Base Block (материя)
  • Abstract Node in the Graph (идея)
  • логика «блок → узел»
```

Итог: **Universe** — высший объект пайплайна, единственный блок, который не наследуется и не является графом; его **нельзя запустить**, только **обучить**; обучение строится на **расхождениях между Миром идей и Миром материи**. В Universe лежат два воплощения **World** (Мир идей и Мир материи). World есть циклический граф из двух блоков (Автор и Создатель); в Мире идей цикл идёт от Автора к Создателю, в Мире материи — от Создателя к Автору. Проект поддерживает обе направленности, не утверждая первичность идеи или материи.

### 8.6 Иерархия уровней представления (зафиксированная)

Ниже зафиксирована **иерархия уровней** от высшего объекта пайплайна до фундаментальных сущностей. Каждый уровень вводит свои абстракции; вышележащий уровень собирается из сущностей нижележащего.

| Уровень (сверху вниз) | Сущность | Описание |
|-----------------------|----------|----------|
| **1. Высший объект пайплайна** | **Universe** (Вселенная) | Единственный блок, который **не наследуется** ни от какого другого блока и **не является графом**. Нельзя **запустить** (launch), можно только **обучить** (train). Полностью уникальная, отдельно стоящая сущность. **Объединяет в себе две абстракции** — два абстрактных блока высшего уровня: **Мир идей** (цикл начинается с Автора, затем Создатель) и **Мир материи** (цикл начинается с Создателя, затем Автор). |
| **2. Два блока высшего уровня внутри Universe** | **World of Ideas** (Мир идей), **World of Matter** (Мир материи) | Две реализации World. Мир идей: цикл выполняется от Автора к Создателю (материализация идей). Мир материи: цикл выполняется от Создателя к Автору (идеализация материи). |
| **3. Автор и Создатель** | **Author**, **Creator** | Каждый из них сам по себе есть **граф пайплайнов** (graph of pipelines): совокупность пайплайнов, связанных в граф. Автор и Создатель — узлы на уровне World, но на следующем уровне представления каждый раскладывается в граф пайплайнов. |
| **4. Пайплайн** | **Pipeline** | Используется как **граф этапов** (graph of stages): пайплайн есть граф, узлами которого служат этапы (stages). |
| **5. Этап** | **Stage** | Вводится понятие **этапа** как **базового графа** (basic graph): один этап — граф (вычислительный граф, подграф), элементарная единица внутри пайплайна. |
| **6. Узлы графа** | **Abstract nodes of the graph** | Абстрактные **узлы графа**: сущности, из которых собираются этапы и графы. Узел — место в графе, к которому применяется логика «блок → узел». |
| **7. Уровень над фундаментом** | **Abstract Backbone, Abstract Solver, Abstract Codec, Abstract Adapter**, … | Абстрактные **специализированные блоки (узлы-задачи)**. Каждый наследуется **одновременно** от Abstract Base Block и от Abstract Graph Node; задаёт **спецификацию задачи** (backbone — ядро/деноising, solver — шаг солвера, codec — encode/decode, adapter — адаптация и т.д.). Конкретные модели — реализации этих абстракций; **из них собирается граф**. См. п. 6. |
| **8. Фундаментальный уровень** | **Abstract Base Block**, **Abstract Graph Node** | **Abstract Base Block** — материальная основа (Lego-кирпич; параметры, тензоры, ссылки). **Abstract Graph Node** — идеальная основа (форма блока в графе); логика преобразования «любой Base Block → Node in the Graph». Самый нижний уровень иерархии. |

Схема иерархии (сверху вниз):

```
Universe (не наследуется, не граф; только train; объединяет Мир идей + Мир материи)
    │
    ├── Мир идей (цикл: Автор → Создатель)
    └── Мир материи (цикл: Создатель → Автор)
            │
            ▼
Автор, Создатель (каждый = граф пайплайнов)
            │
            ▼
Pipeline (граф этапов)
            │
            ▼
Stage (базовый граф / граф как единица)
            │
            ▼
Узлы графа (абстрактные)
            │
            ▼
Abstract Backbone, Solver, Codec, Adapter, … (узлы-задачи; двойное наследование Block + Node; из конкретных реализаций собирается граф)
            │
            ▼
Abstract Base Block  +  Abstract Graph Node (логика блок → узел)
```

Таким образом, от **Universe** (единственная сущность вне наследования и графа, только обучение) через два **World** (идей и материи), затем **Автор и Создатель** (графы пайплайнов), **пайплайн** (граф этапов), **этап** (базовый граф), **узлы графа**, уровень **абстрактных узлов-задач** (Abstract Backbone, Solver, Codec, Adapter — двойное наследование Block + Node; из конкретных реализаций собирается граф) до **Abstract Base Block** и **Abstract Graph Node** выстраивается единая иерархия уровней представления.

---

## 9. Использование документа

Этот файл — **главный ориентир** при проектировании:

- **уровень абстрактных узлов-задач** (Backbone, Solver, Codec, Adapter и др.) описан в [Abstract_Nodes_Level.md](Abstract_Nodes_Level.md);
- **уровень графа как целого (Stage) и пайплайна (Pipeline)**, модальность и контекст описаны в [Graph_Stage_Level.md](Graph_Stage_Level.md);
- **сводная иерархия уровней** (таблица, схема, направление сборки) — в [Level_Hierarchy.md](Level_Hierarchy.md);
- **иерархия уровней** зафиксирована в п. 8.6: от Universe через Мир идей / Мир материи → Автор и Создатель (графы пайплайнов) → Pipeline (граф этапов) → Stage (базовый граф) → узлы графа → уровень абстрактных узлов-задач (Abstract Backbone, Solver, Codec, Adapter и др.; двойное наследование Block + Node; из конкретных реализаций собирается граф) → Abstract Base Block и Abstract Graph Node;
- все новые сущности соотносятся с блоком (материя) и/или узлом графа (идея) и с уровнем этой иерархии;
- новые механики не нарушают принцип «всё можно соединять со всем» в рамках графа;
- расширения добавляют новые типы блоков или новые правила преобразования, а не обход фундаментального уровня;
- **над всем** — объект **Universe** (Вселенная): единственный блок, не наследуемый ни от кого и не являющийся графом; полностью уникальная сущность; **не запускается, только обучается**; обучение Universe строится на **расхождениях между Миром идей и Миром материи**. Universe хранит два воплощения World (Мир идей: цикл Автор→Создатель; Мир материи: цикл Создатель→Автор). **Целевая вершина** ниже Universe — объект **World** (циклический граф Автора и Создателя), пригодный к запуску и обучению. Yggdrasil — многомерный граф на каждом уровне ниже Universe; суть проявляется во взаимодействии идеи с материей и материи с идеей.

Дальнейшие уточнения и правки философии вносятся в этот документ и затем отражаются в To_do и технической реализации.
