# Гиперграф как движок фреймворка и крупномасштабные гиперссылки

**Единый канон проекта:** [CANON.md](CANON.md). Вся архитектура YggDrasill должна быть устроена как **гиперграф**; **гиперссылки** обеспечивают связывание контекстов и взаимодействие в масштабе всего фреймворка.

---

## 1. Гиперграф — основной движок фреймворка

- **Идея:** всё в проекте должно быть устроено как **гиперграф** (hypergraph). В обычном графе ребро соединяет ровно два узла; в **гиперграфе** **гиперребро (hyperedges)** может соединять **любое число узлов** (в том числе одно или более двух). Таким образом, граф — частный случай гиперграфа (все рёбра имеют размер 2).
- **Узлы** на каждом уровне иерархии (блоки, узлы-задачи, графы, пайплайны, этапы, миры, при расширении — миры во вселенной) суть **вершины гиперграфа**. **Гиперрёбра** задают связи и отношения между ними: не только парные (A—B), но и групповые (A—B—C, или «контекст K связывает миры W1, W2, W3»).
- **Движок фреймворка** должен опираться на гиперграф: структура данных и исполнение (топология, обход, передача данных) определяются гиперграфом. Там, где в документации говорится о «графе» (граф узлов-задач, граф графов, граф этапов, граф миров), имеется в виду представление в рамках **гиперграфа** (в частности, граф как подслучай при гиперрёбрах размера 2).
- **Следствия:** (1) одна и та же модель (гиперграф) от блока до вселенной; (2) естественная поддержка групповых связей (один контекст связывает несколько миров, один артефакт — несколько этапов); (3) расширяемость без смены парадигмы — добавление гиперрёбер произвольной арности.

---

## 2. Крупномасштабные гиперссылки для контекстов и взаимодействия

- **Гиперссылка (hyperlink)** в каноне — это **связь, указывающая на сущность или контекст** и позволяющая **связывать контексты и организовывать взаимодействие** в масштабе всего фреймворка. Гиперссылки должны поддерживаться на всех уровнях: от ссылки на порт/блок до ссылки на мир, этап, артефакт или «конец мира» (End World).
- **Крупномасштабные гиперссылки** нужны для: (1) **связывания контекстов** — например, диалог в мире A отсылает к контексту мира B (книга, фиксированный мир) без изменения B; (2) **взаимодействия** — персонажи, этапы, миры могут ссылаться друг на друга и на общие объекты (End Worlds); (3) **навигации и разрешения** — по гиперссылке движок находит целевую сущность (мир, блок, state, артефакт) и может подставлять контекст в вычисление или в нарратив.
- **Введение в структуру проекта:** контракты уровней (граф, пайплайн, этап, мир, вселенная) должны допускать **хранение и передачу гиперссылок** (идентификатор типа + целевой ref: world_id, block_id, artifact_id, end_world_id и т.д.). Сериализация и чекпоинты должны сохранять гиперссылки; при загрузке ссылки разрешаются в рамках текущей вселенной/каталога миров.
- **Связь с End Worlds:** миры-объекты (фиксированные, неизменяемые «конец миры») выступают **целями гиперссылок**: на них можно ссылаться из других миров, обогащая контекст и историю персонажей без изменения самого End World ([END_WORLDS.md](END_WORLDS.md)).

---

## 3. Соотношение с существующими документами

| Уровень | В каноне | В модели гиперграфа |
|---------|----------|----------------------|
| Граф ([Graph_Level.md](Graph_Level.md)) | Узлы-задачи, рёбра между портами | Гиперграф: вершины = узлы; гиперрёбра размера 2 = обычные рёбра; при необходимости гиперрёбра большей арности (общий контекст для нескольких узлов). |
| Пайплайн ([Pipeline_Level.md](Pipeline_Level.md)) | Графы как узлы, рёбра между графами | Гиперграф графов; гиперссылки между графами и на внешние артефакты/миры. |
| Этап, мир ([Stage_Level.md](Stage_Level.md), [World_Level.md](World_Level.md)) | Граф этапов, state по рёбрам | Гиперграф этапов; гиперрёбра могут кодировать общий state или ссылку на End World. |
| Вселенная ([EXPANSION_UNIVERSE_GRAPH_OF_WORLDS.md](EXPANSION_UNIVERSE_GRAPH_OF_WORLDS.md)) | Граф миров | **Гиперграф миров:** вершины = миры (в т.ч. End Worlds); гиперрёбра = связи между мирами и групповые связи (несколько миров + общий контекст); **гиперссылки** — ссылки из мира/персонажа на мир (в т.ч. End World) или на артефакт. |

---

## 4. Краткая сводка

| Вопрос | Ответ |
|--------|--------|
| **Что такое движок фреймворка?** | **Гиперграф.** Вся структура (блоки, графы, пайплайны, этапы, миры, вселенная) представляется и исполняется в рамках гиперграфа; обычный граф — случай гиперграфа с рёбрами размера 2. |
| **Зачем гиперссылки?** | **Связывание контекстов и взаимодействие** в масштабе фреймворка: ссылки на миры, артефакты, End Worlds; обогащение контекста диалогов и историй без изменения целевой сущности (например, End World). |
| **Где вводить?** | В контракты всех уровней (хранение и передача гиперссылок); в сериализацию; в модель вселенной и End Worlds. |
