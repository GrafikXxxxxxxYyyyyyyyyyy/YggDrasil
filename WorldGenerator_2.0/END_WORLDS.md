# End Worlds (миры-завершения): фиксированные миры и связь с объектными мирами

**Единый канон проекта:** [CANON.md](CANON.md). Фреймворк должен поддерживать **End Worlds** (миры-завершения) — миры, которые **не изменяются** и **фиксированы**, но к которым можно **привязываться** и с которыми можно **взаимодействовать** со стороны других (объектных) миров; при этом история и контекст объектного мира обогащаются, а сам End World остаётся неизменным.

Связь с гиперграфом и гиперссылками: [HYPERGRAPH_AND_HYPERLINKS.md](HYPERGRAPH_AND_HYPERLINKS.md). Расширение вселенной: [EXPANSION_UNIVERSE_GRAPH_OF_WORLDS.md](EXPANSION_UNIVERSE_GRAPH_OF_WORLDS.md).

---

## 1. Определение End World

- **End World (мир-завершение)** — мир, который **не изменяется** и **фиксирован**: его состояние, контент и история не пересчитываются и не перезаписываются фреймворком. End World существует как **заданная сущность** (например, канонический текст книги, зафиксированный сюжет, неизменяемый «законченный» мир). В терминах класса/типа: End World — сущность в **мировом классе** (world class), представляющая именно такой фиксированный мир.
- **Не как прямой объект:** End World не обязательно хранится «напрямую» как один объект в памяти — он существует как **сущность** (entity) в модели: идентифицируется (end_world_id), может быть загружен по ссылке, его контент доступен только на чтение. Важно: к нему можно **ссылаться** и с ним можно **взаимодействовать** (читать контекст, цитировать, использовать в диалогах).
- **End World как мир пользователя без весов и запуска:** End World может быть представлен **миром пользователя**, который пользователь разработал, но **сериализовал только одну его часть** — **контент мира**, **без** весов моделей и **без** возможностей запуска/инференса. То есть End World — это объект мира, в сериализации которого присутствует **только контент мира**, а **не** сериализация исполняемой части (структура пайплайнов, чекпоинты, конфиг запуска на локальной машине или на inference-сервере и т.д.). Грубо говоря: только **история и содержание мира**, без «движка».

---

## 2. Связь с объектными мирами и взаимодействие

- **Объектный мир (Object World / Near World)** — мир, который **развивается** (цикл этапов, state обновляется). Персонажи и сущности объектного мира могут **ссылаться на End World** и **взаимодействовать с ним** в смысле использования его контекста (чтение, цитирование, обсуждение), при этом **End World не меняется**.
- **Взаимодействие:** например, персонаж A из объектного мира (Mirror World / Near World) в **диалоге с персонажем B** отсылает к End World — например, к **книге** (книга = End World: фиксированный, неизменяемый текст и сюжет). Диалог A и B может обсуждать сюжет книги, цитировать её; контекст книги обогащает диалог. **Сам End World (книга) не изменяется.** Но **контекст взаимодействия персонажей A и B обогащается**; **история персонажа A** и **история персонажа B** в объектном мире могут измениться (например, в state мира фиксируется, что они обсуждали данную книгу, их биографии обогащаются). Итого: End World остаётся фиксированным; объектный мир (Near World), в котором есть персонажи A и B, **обогащает свой контекст и свои истории** за счёт связи с End World.
- **Связывание:** объектный мир может быть **связан** с одним или несколькими End Worlds через **гиперссылки** ([HYPERGRAPH_AND_HYPERLINKS.md](HYPERGRAPH_AND_HYPERLINKS.md)): в state или в метаданных мира хранятся ссылки на end_world_id; при выполнении этапов (например, Автор, Development of the world) контекст End World может подставляться в LLM или в нарратив как доступный только на чтение.

---

## 3. Пример (канон)

- **End World:** книга (законченный, неизменяемый мир — текст и сюжет книги).
- **Объектный мир (Near World):** мир, в котором существуют персонажи A и B.
- Персонаж A в диалоге с персонажем B **отсылает** к книге (End World). Диалог может содержать обсуждение книги, цитаты, отсылки. **Книга (End World) не меняется.** Контекст фиксированного мира книги **обогащает** взаимодействие A и B; **история персонажа A** и **история персонажа B** в объектном мире обогащаются (в state мира фиксируется факт обсуждения, релевантные фрагменты контекста). End World существует как **сущность в мировом классе** — не обязательно как один «объект», но как идентифицируемая сущность, к которой можно привязаться и контекст которой доступен для чтения.

---

## 4. Два крупномасштабных поля сериализации мира и End World

В сериализации **мира** (как общей сущности) должны быть выделены **два крупномасштабных поля**:

| Поле | Содержимое |
|------|-------------|
| **Структура / исполняемая часть (execution)** | Сериализация **того, как мир должен быть собран и запущен**: на локальной машине, на inference-сервере или любым иным поддерживаемым способом. Сюда входят: структура цикла, этапы, пайплайны, графы, конфиги блоков, ссылки на чекпоинты (веса моделей), параметры запуска, схема state и т.д. — всё, что нужно для **выполнения** мира. |
| **Контент мира (content)** | **Всё, что наполняет мир:** описания, история, фото, видео, звуки, артефакты, глоссарий, нарратив — всё, что относится к **содержанию** мира. Всё должно быть помечаемо и хранимо в этом суперполе. |

- **Полный мир (объектный мир)** при сериализации содержит **оба** поля: и структуру/исполняемую часть, и контент. Из такой сериализации мир можно собрать и запустить, а также восстановить его содержание.
- **End World** как объект — это сериализация, в которой есть **только контент мира** (второе поле), **без** сериализации исполняемой части. То есть без весов моделей, без конфигурации запуска на локальной машине или inference-сервере; только история, описания, медиа и всё, что наполняет мир. End World может быть получен из пользовательского мира: пользователь разработал мир, а затем **сериализовал только контент** — получился End World, пригодный для ссылок и чтения из других миров, без возможности его перезапуска/изменения.

Связь с сериализацией мира в целом: [World_Serialization.md](World_Serialization.md).

---

## 5. Требования к реализации и документации

- **Поддержка End Worlds:** в модели вселенной (и при необходимости на уровне мира) должны быть предусмотрены: (1) тип или маркер мира «End World» (фиксированный, только чтение); (2) идентификация end_world_id и разрешение по гиперссылке; (3) запрет на запись/обновление state End World со стороны движка.
- **Гиперссылки на End Worlds:** в контрактах уровней (мир, вселенная) и в state допускается хранение **гиперссылок на End World**; при выполнении этапов (Автор, Среда, агенты) контекст End World может быть подставлен по ссылке (чтение). Сериализация и загрузка сохраняют эти ссылки.
- **Документация:** все документы канона и docs, где речь идёт о мирах и вселенной, должны учитывать наличие **End Worlds** и **связь объектных миров с ними** без изменения End World; при описании графа/гиперграфа миров — наличие вершин типа End World и гиперссылок на них.
- **Два поля сериализации:** в спецификации сериализации мира должны быть явно выделены два крупномасштабных поля — (1) структура/исполняемая часть, (2) контент мира; End World = только поле контента, без исполняемой части.
