# Полная сериализуемость на всех уровнях представления

**Принцип:** проект (фреймворк) должен быть **полностью сериализуем на каждом уровне представления** — от фундамента (блок, узел) до высшей абстракции (мир). **Веса сериализуются на каждом уровне.** Для **каждого уровня** должна быть **возможность загрузки из чекпоинта**.

Канон: [World_Serialization.md](World_Serialization.md), [System.md](System.md).

---

## 1. Зачем

- **Воспроизводимость:** любую собранную сущность можно сохранить в конфиг/чекпоинт и загрузить обратно.
- **Переносимость:** граф, пайплайн, этап, мир задаются конфигом и не привязаны к одному процессу или машине.
- **Расширяемость:** новые блоки и миры описываются конфигом и шаблонами без обязательного изменения кода.

---

## 2. Уровни и что сериализуется (структура + веса)

| Уровень | Сущность | Что сериализуется (структура) | Веса (чекпоинт) |
|---------|----------|-------------------------------|-----------------|
| **Фундамент** | Block, Node | `block_type`, `block_id`, конфиг блока, порты; узел = имя + ссылка на блок + рёбра. | **Веса блока** (state_dict) сериализуются; загрузка блока из чекпоинта на уровне блока. |
| **Узлы-задачи** | Backbone, Solver, Codec, … | Тип узла-задачи, конфиг экземпляра, порты. | Веса узла-задачи = веса блока; сериализация и загрузка из чекпоинта на уровне узла. |
| **Граф** | Один граф = одна задача | Список узлов, рёбер, внешние входы/выходы. | **Веса графа** = объединённые веса всех узлов (или ссылки на чекпоинты узлов). Сериализация графа включает веса; **загрузка графа из чекпоинта** — восстановление структуры и весов всех узлов. |
| **Пайплайн** | Граф графов | Узлы = графы; рёбра; входы/выходы пайплайна. | **Веса пайплайна** = веса всех графов-узлов. На уровне пайплайна — сериализация и **загрузка пайплайна из чекпоинта**. |
| **Этап (Stage)** | Граф пайплайнов | Узлы = пайплайны; рёбра; контракт по state. | **Веса этапа** = веса всех пайплайнов. Сериализация и **загрузка этапа из чекпоинта**. |
| **Мир (World)** | Граф этапов | Порядок этапов (цикл), конфиг этапов, схема state, пути сохранения. | **Веса мира** = веса всех этапов (и всех блоков внутри). Сериализация мира включает веса; **загрузка мира из чекпоинта** — полное восстановление мира (структура + веса). |

На каждом уровне: **сохранить** → конфиг + **чекпоинт весов** этого уровня; **загрузить** → восстановить сущность того же уровня из конфига и **загрузить веса из чекпоинта**.

---

## 3. Загрузка из чекпоинта на каждом уровне

Для **каждого уровня** должна быть реализована **возможность загрузки из чекпоинта**:

- **Блок:** `load_from_checkpoint(path)` или загрузка state_dict в блок — восстановление весов блока.
- **Узел:** загрузка весов блока, находящегося в узле.
- **Граф:** загрузка графа из чекпоинта — восстановление структуры (из конфига) и загрузка весов всех узлов (один файл чекпоинта графа или каталог с чекпоинтами узлов).
- **Пайплайн:** загрузка пайплайна из чекпоинта — структура + веса всех графов-узлов.
- **Этап:** загрузка этапа из чекпоинта — структура + веса всех пайплайнов.
- **Мир:** загрузка мира из чекпоинта — структура цикла, этапы, пайплайны, графы, блоки + все веса (канон [World_Serialization.md](World_Serialization.md)).

Итого: на **каждом уровне** сущность можно не только сериализовать (конфиг + веса), но и **загрузить из чекпоинта** этого уровня, получив полностью восстановленную структуру и веса.

---

## 4. Следствия для реализации

- **Фундамент:** у каждого блока — сериализуемый конфиг, идентификаторы и **state_dict (веса)**; сохранение и загрузка блока из чекпоинта.
- **Граф / Пайплайн / Этап / Мир:** структура задаётся данными (YAML/JSON); **веса сериализуются на каждом уровне** (агрегация весов вложенных сущностей); для каждого уровня — API загрузки из чекпоинта (например, `Graph.load_from_checkpoint()`, `Pipeline.load_from_checkpoint()`, `World.load_from_checkpoint()`).
- **Мир:** из конфига + чекпоинта восстанавливаются структура цикла, узлы мира, конфиги блоков, схема state и **все веса** мира.

Итого: от блока до мира **веса сериализуются на каждом уровне**, и на **каждом уровне** возможна **загрузка из чекпоинта**.
