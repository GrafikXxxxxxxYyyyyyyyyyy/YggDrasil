# Уровень мира (World): непрерывная цепь переходов

**Единый канон проекта:** [CANON.md](CANON.md). Подробное описание **уровня мира (World)** как верхнего уровня системы.

**Мир — непрерывная цепь крупномасштабных переходов (transitions):** Философ → Автор → Среда → Архитектор → Творец. Каждый компонент — **переход**, то есть **фаза мира**, **преобразование state** — фундаментальная метаморфоза состояния (материя ↔ идея, объект в объект; см. [Scheme.md](Scheme.md) §1.0). В структурном представлении мир — **граф переходов:** узлами являются переходы (реализуемые на уровне Stage как граф пайплайнов), по рёбрам передаётся **state**. В каноне граф **циклический**, порядок выполнения фиксирован. Идеальные задачи переходов — [Scheme.md](Scheme.md) §1.1.

Ниже: [Stage_Level.md](Stage_Level.md) (уровень перехода: реализация метаморфозы). Операционный канон цикла и state: [Scheme.md](Scheme.md), [System.md](System.md). Сериализация: [World_Serialization.md](World_Serialization.md).

---

## 1. Положение мира в иерархии

| Уровень | Состоит из | Описание |
|---------|------------|----------|
| **Граф** ([Graph_Level.md](Graph_Level.md)) | Узлов-задач | Одна задача (text-to-image, upscale и т.д.). |
| **Пайплайн** ([Pipeline_Level.md](Pipeline_Level.md)) | Графов | Граф графов; комбинированные задачи. |
| **Переход (Stage)** ([Stage_Level.md](Stage_Level.md)) | Пайплайнов | Уровень перехода: граф пайплайнов, реализующий один **переход** (метаморфозу state) в цикле мира. |
| **Мир (World)** | **Переходов** | **Мир — граф переходов (цепочка переходов).** Узлами мира являются переходы (Философ, Автор, Среда, Архитектор, Творец); по рёбрам передаётся **state**. В каноне — **циклический граф** с фиксированным порядком. |

Итого: **граф** (узлы = узлы-задачи) → **пайплайн** (узлы = графы) → **переход/Stage** (узлы = пайплайны; один переход = одна метаморфоза state) → **мир** (узлы = переходы). **Мир — непрерывная цепь переходов;** каждое звено цикла — переход со своей ролью (преобразование состояния).

---

## 2. Определение уровня мира: мир как цепочка переходов (граф переходов)

**Мир (World)** — это **непрерывная цепь крупномасштабных переходов:** структурно **граф, узлами которого являются переходы (transitions)**. На уровне мира единицей является **переход** — фаза, осуществляющая **метаморфозу state** (фундаментальное преобразование состояния: материя → идея, идея → материя, объект в объект; см. [Scheme.md](Scheme.md) §1.0). Каждый переход реализуется на уровне Stage (граф пайплайнов). Рёбра мира соединяют выход одного перехода с входом другого; по рёбрам передаётся **state** (в каноне — контейнер из пяти блоков). Порядок обхода задаёт последовательность переходов; в каноне граф **циклический** и порядок **фиксирован**.

- **Узлы мира** — **переходы** (Философ, Автор, Среда, Архитектор, Творец в одном цикле). Каждый переход реализуется как Stage — граф пайплайнов ([Stage_Level.md](Stage_Level.md)); с точки зрения мира переход — атомарная единица с ролью и контрактом по state, осуществляющая одну метаморфозу.
- **Рёбра мира** — связи между переходами; по ним передаётся **state**. Вход мира (на шаге цикла) — state после предыдущего прохода или после Development of the world; выход перехода мапится в state и подаётся на вход следующего перехода.
- **Выполнение мира** — последовательное выполнение переходов в порядке графа; после последнего перехода цикл повторяется (новый state создаётся в Среда (Development of the world) и снова идёт по цепочке переходов).

Таким образом, **мир — граф переходов (цепочка переходов):** структура мира есть структура этой цепочки (какие переходы, в каком порядке); state течёт по рёбрам, на каждом переходе претерпевая метаморфозу; цикл замыкается через Среда (Development of the world → новый state с блоком 1 → Архитектор → … → Среда).

---

## 3. Цикл мира: пять переходов (пять фаз)

В каноне ([Scheme.md](Scheme.md), [System.md](System.md)) мир — **циклическая цепочка из пяти переходов**. Каждое звено — **переход** (transition): метаморфоза state, фаза мира.

```
  Философ  →  Автор  →  Среда  →  Архитектор  →  Творец  →  …
```

| № в цикле | Переход (роль) | Вход (state) | Условие выполнения / Метаморфоза | Выход (state) |
|-----------|----------------|----------------|----------------------------------|----------------|
| 1 | **Философ** (Philosopher) | Блоки 1, 2, 3 | **Только если заполнены 1, 2, 3.** Материя → идея: описывает блок 3 → блок 4 | Блок 4 |
| 2 | **Автор** (Author) | Блоки 1–4 | **Только если заполнены 1, 2, 3, 4.** В ядре LLM; идея → нарратив (блок 5) | Блок 5 |
| 3 | **Среда** (Environment) (World update + Development of the world) | State, опционально Action | **World update — только при полном state (все 5 блоков).** Development — безусловно → новый эпизод (state с блоком 1) | Новый state с блоком 1 |
| 4 | **Архитектор** (Architect) | Блок 1 | При блоке 1. Идея → техническая структура: генерирует **конфигурацию** (блок 2) | Блок 2 |
| 5 | **Творец** (Creator) | Блок 2 | При блоке 2. Конфигурация → материя: генерация артефактов (блок 3) | Блок 3 |

После пятого перехода state с блоком 3 снова попадает в Философ → Автор → Среда → Архитектор → Творец — цикл повторяется. **Каждое звено — переход:** мир собран из переходов, каждый переход осуществляет фундаментальное преобразование состояния. Идеальные задачи переходов — [Scheme.md](Scheme.md) §1.1.

---

## 4. State: что течёт по цепочке переходов

По рёбрам графа мира между **переходами** передаётся **state**. В каноне state задаётся **пятью блоками** ([Scheme.md](Scheme.md), [System.md](System.md)):

| № | Блок |
|---|------|
| 1 | Описание того, что должно было произойти |
| 2 | Конфигурация для генерации артефактов |
| 3 | Сгенерированные артефакты |
| 4 | Описание сгенерированных артефактов |
| 5 | Описание того, что реально произошло в мире |

- **World update** (внутри перехода Среда) выполняется только при заполненном блоке 5: state применяется к миру (контент мира обновляется), state сохраняется. Иначе обновление не выполняется, state отбрасывается.
- **Development of the world** (внутри перехода Среда) создаёт **новый state** с заполненным только блоком 1; этот state передаётся по ребру мира в переход Архитектор — цикл продолжается.

Таким образом, **state** — то, что течёт по **цепочке переходов** (миру); на каждом переходе state претерпевает метаморфозу; на уровне графа и пайплайна по связям текут данные, на уровне переходов и мира — state.

---

## 5. Выполнение мира: порядок и один цикл

- **Порядок выполнения** задаётся графом мира (цепочкой переходов). В каноне порядок **фиксирован**: Философ → Автор → Среда → Архитектор → Творец → снова Философ → … На каждом шаге мир выполняется в одном и том же порядке.
- **Один проход цикла:** state последовательно проходит **переходы**; каждый переход осуществляет метаморфозу state; после Среда (Development of the world) новый state с блоком 1 идёт в Архитектор, и цикл повторяется.
- **Action** поступает в Development of the world как контекст для LLM; опционален. **Если пользователь не передал state** (или пустой state): на **первой итерации** пропускаются **Философ**, **Автор** и **World update**; цикл **начинается с Development of the world**, который создаёт **первый state** (блок 1). Передача state пользователем определяет, какие переходы пропускаются и как применяется обновление мира. Подробно: [Scheme.md](Scheme.md) §4.8.

---

## 6. Компоненты уровня мира

- **Мир (World)** — единственная сущность уровня: **цепочка переходов** (граф переходов). Идентифицируется как верхняя абстракция системы (конфиг мира, имя мира, хранилище).
- **Узлы мира** — **переходы** (Философ, Автор, Среда, Архитектор, Творец). Каждый переход имеет роль, контракт входа/выхода по state и внутреннюю реализацию на уровне Stage (граф пайплайнов); осуществляет одну метаморфозу состояния.
- **Рёбра мира** — связи «выход перехода → вход следующего перехода»; по ним передаётся state.
- **State** — контейнер данных (пять блоков в каноне), передаваемый между переходами и претерпевающий метаморфозы; при необходимости расширяется ([Scheme.md](Scheme.md)).

Сериализация мира (конфиг, шаблон, загрузка, чекпоинт): [World_Serialization.md](World_Serialization.md).

---

## 7. Сводка

| Понятие | Определение |
|---------|-------------|
| **Уровень мира** | Верхний уровень системы. Основная сущность — **World (мир)**. |
| **Мир (World)** | **Непрерывная цепь крупномасштабных переходов (граф переходов):** узлами мира являются **переходы** (Философ, Автор, Среда, Архитектор, Творец). По рёбрам передаётся **state**; каждый переход осуществляет **метаморфозу** состояния. В каноне — циклический граф с фиксированным порядком. |
| **Переход (Transition)** | Фундаментальное изменение состояния системы; метаморфоза (материя ↔ идея, объект в объект). Каждое звено цикла мира — переход; реализуется на уровне Stage (граф пайплайнов). См. [Scheme.md](Scheme.md) §1.0, [Stage_Level.md](Stage_Level.md). |
| **State** | То, что течёт по цепочке переходов и претерпевает метаморфозы (пять блоков в каноне). |
| **Выполнение** | Последовательное выполнение переходов в порядке графа; цикл повторяется; Action опционален, мир может развиваться сам. |

Граф и пайплайн: [Graph_Level.md](Graph_Level.md), [Pipeline_Level.md](Pipeline_Level.md). Этап: [Stage_Level.md](Stage_Level.md). Канон цикла и state: [Scheme.md](Scheme.md), [System.md](System.md). Сериализация: [World_Serialization.md](World_Serialization.md).
